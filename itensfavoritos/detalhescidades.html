<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detalhes das Cidades</title>
  <link rel="stylesheet" href="styles.css">

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    crossorigin=""
  ></script>
</head>

<body>
  <div id="container">
    <!-- Conteúdo será inserido via JS -->
  </div>

  <script>
    // Função para pegar parâmetro da URL
    function getQueryParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    async function carregarCidades() {
      const grupo = getQueryParam('grupo'); // espera '1' ou '2'
      const response = await fetch('cidades.json');
      const data = await response.json();

      const container = document.getElementById('container');
      container.innerHTML = ''; // limpa conteúdo anterior

      if (grupo === '1') {
        container.innerHTML = `
          <h1>Grupo 1 - Salvador, Olinda e Ouro Preto</h1>
          <div id="grupo1"></div>
        `;
        const grupo1Container = document.getElementById('grupo1');
        data.grupo1.forEach((cidade, index) => {
          const section = document.createElement('section');
          const mapaId = `mapa-grupo1-${index}`;
          section.innerHTML = `
            <header>
              <img src="${cidade.imagem}" alt="Imagem de ${cidade.nome}" />
              <h2>${cidade.nome}</h2>
            </header>
            <div class="content">
              <h3>Sobre o Destino</h3>
              ${cidade.descricao.map(p => `<p>${p}</p>`).join('')}
              <h3>Principais Atrações</h3>
              <ul>${cidade.atracoes.map(item => `<li>${item}</li>`).join('')}</ul>
              <h3>Quando Visitar</h3>
              <p>${cidade.quando_visitar}</p>
              <h3>Dicas Úteis</h3>
              <p>${cidade.dicas}</p>
              <div class="map-container">
                <h3>Mapa</h3>
                <div id="${mapaId}" class="map"></div>
              </div>
            </div>
          `;
          grupo1Container.appendChild(section);

          // Inicializa o mapa Leaflet
          const mapa = L.map(mapaId).setView([cidade.coordenadas.lat, cidade.coordenadas.lng], 13);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
          }).addTo(mapa);
          L.marker([cidade.coordenadas.lat, cidade.coordenadas.lng]).addTo(mapa)
            .bindPopup(`<b>${cidade.nome}</b>`).openPopup();
          mapa.invalidateSize();
        });
      } else if (grupo === '2') {
        container.innerHTML = `
          <h1>Grupo 2 - Belo Horizonte e São Paulo</h1>
          <div id="grupo2"></div>
        `;
        const grupo2Container = document.getElementById('grupo2');
        data.grupo2.forEach((cidade, index) => {
          const section = document.createElement('section');
          const mapaId = `mapa-grupo2-${index}`;
          section.innerHTML = `
            <header>
              <img src="${cidade.imagem}" alt="Imagem de ${cidade.nome}" />
              <h2>${cidade.nome}</h2>
            </header>
            <div class="content">
              <h3>Sobre o Destino</h3>
              ${cidade.descricao.map(p => `<p>${p}</p>`).join('')}
              <h3>Principais Atrações</h3>
              <ul>${cidade.atracoes.map(item => `<li>${item}</li>`).join('')}</ul>
              <h3>Quando Visitar</h3>
              <p>${cidade.quando_visitar}</p>
              <h3>Dicas Úteis</h3>
              <p>${cidade.dicas}</p>
              <div class="map-container">
                <h3>Mapa</h3>
                <div id="${mapaId}" class="map"></div>
              </div>
            </div>
          `;
          grupo2Container.appendChild(section);

          // Inicializa o mapa Leaflet
          const mapa = L.map(mapaId).setView([cidade.coordenadas.lat, cidade.coordenadas.lng], 13);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
          }).addTo(mapa);
          L.marker([cidade.coordenadas.lat, cidade.coordenadas.lng]).addTo(mapa)
            .bindPopup(`<b>${cidade.nome}</b>`).openPopup();
          mapa.invalidateSize();
        });
      } else {
        container.innerHTML = `<p>Grupo inválido. Por favor, selecione um grupo válido.</p>`;
      }

      // Adiciona o botão de voltar no final
      container.insertAdjacentHTML('beforeend', `<a href="index.html" class="btn-back">⬅ Voltar ao Início</a>`);
    }

    carregarCidades();
  </script>
</body>
</html>
